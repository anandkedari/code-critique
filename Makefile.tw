.PHONY: help build run down test

# Colors for output
BLUE := \033[0;34m
GREEN := \033[0;32m
YELLOW := \033[0;33m
NC := \033[0m # No Color

build: ## Build Docker image (REQUIRED: AI_PROVIDER=anthropic or AI_PROVIDER=openai)
	@if [ -z "$(AI_PROVIDER)" ]; then \
		echo "$(YELLOW)Error: AI_PROVIDER is required. Set to 'anthropic' or 'openai'$(NC)"; \
		echo "$(YELLOW)Example: AI_PROVIDER=anthropic make build$(NC)"; \
		exit 1; \
	fi
	@echo "$(BLUE)Building Docker image with AI_PROVIDER=$(AI_PROVIDER)...$(NC)"
	@docker build --build-arg AI_PROVIDER=$(AI_PROVIDER) -t code-critique:latest -f Dockerfile .
	@echo "$(GREEN)✓ Image built for $(AI_PROVIDER) provider$(NC)"

analyze: ## Run analysis
	@echo "$(BLUE)Running code-critique...$(NC)"
	@SERVICE_NAME=$$(basename "$(SERVICE_PATH)") docker compose up --abort-on-container-exit
	@echo "$(GREEN)✓ Analysis complete!$(NC)"
