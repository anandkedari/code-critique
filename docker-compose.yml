version: '3.8'

services:
  code-critique:
    image: localhost:5000/code-critique:latest
    container_name: code-critique
    command: sh -c "python3 scripts/analyze-service.py && pwd && ls && echo "--reports/service--" && ls -la reports/service && echo "--reports/customer-service--" && ls -la reports/customer-service"
    environment:
      - AI_PROVIDER=${AI_PROVIDER}
      - AI_MODEL=${AI_MODEL}
      - AI_API_KEY=${AI_API_KEY}
      - AI_API_URL=${AI_API_URL}
      - AI_CONFIDENCE_THRESHOLD=${AI_CONFIDENCE_THRESHOLD}
      - SERVICE_PATH=/service
      - SERVICE_NAME=${SERVICE_NAME}
      # TEST_SCENARIOS_FILE is set by Makefile to /service/filename
      - TEST_SCENARIOS_PATH=${TEST_SCENARIOS_FILE}
    volumes:
      # Mount reports directory (read-write)
      - ../reports/:/app/code-critique
      # Note: Service code is copied via docker cp in Makefile, not mounted
    working_dir: /app/code-critique
    extra_hosts:
      - "host.docker.internal:host-gateway"
